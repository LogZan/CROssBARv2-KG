# STRING æ•°æ®å¤„ç†æ…¢çš„çœŸæ­£åŸå› 

## ğŸ¯ æ ¸å¿ƒå‘ç°

**å³ä½¿æ•°æ®å·²ç¼“å­˜ï¼Œæ¯ä¸ªç‰©ç§ä»éœ€è¦ ~15ç§’å¤„ç†æ—¶é—´**

åŸå› ï¼š**ä¸æ˜¯ç½‘ç»œä¸‹è½½ï¼Œè€Œæ˜¯æ•°æ®å¤„ç†çš„å›ºæœ‰æˆæœ¬**

## ğŸ“Š æ€§èƒ½åˆ†è§£ (ä»¥äººç±»ä¸ºä¾‹)

```
æ¯ä¸ªç‰©ç§çš„å¤„ç†æµç¨‹:

1. è¯»å– physical interactions         ~5s  (è§£å‹ + è§£æ 1,477,610 æ¡è®°å½•)
   â””â”€ è§£å‹ .gz æ–‡ä»¶                   ~2s
   â””â”€ é€è¡Œè§£ææ–‡æœ¬                    ~2s
   â””â”€ æ„å»ºå­—å…¸                        ~1s

2. è¯»å– links                        ~8s  (è§£å‹ + è§£æ ~11M è¡Œ)
   â””â”€ è§£å‹ .gz æ–‡ä»¶                   ~3s
   â””â”€ é€è¡Œè§£ææ–‡æœ¬                    ~4s
   â””â”€ è¿‡æ»¤ + å­—å…¸æŸ¥è¯¢                 ~1s

3. å…¶ä»–å¼€é”€                          ~2s
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ€»è®¡                                  ~15s
```

**å¯¹äº 12,535 ä¸ªç‰©ç§**:
- 12,535 Ã— 15ç§’ = **188,025 ç§’ = 52.2 å°æ—¶**
- ä¸ä½ è§‚å¯Ÿåˆ°çš„ 55+ å°æ—¶å»åˆ âœ“

## ğŸ” ä¸ºä»€ä¹ˆç¼“å­˜è¿˜æ˜¯æ…¢ï¼Ÿ

### ç¼“å­˜é¿å…äº†ä»€ä¹ˆï¼š
âœ… ç½‘ç»œä¸‹è½½ (å¯èƒ½éœ€è¦æ•°å¤©)  
âœ… HTTP è¯·æ±‚å¼€é”€

### ç¼“å­˜æ— æ³•é¿å…ä»€ä¹ˆï¼š
âŒ **è§£å‹ç¼©** - æ¯ä¸ª .gz æ–‡ä»¶éƒ½éœ€è¦ zlib è§£å‹  
âŒ **æ–‡æœ¬è§£æ** - é€è¡Œè¯»å–ï¼Œå­—ç¬¦ä¸² splitï¼Œç±»å‹è½¬æ¢  
âŒ **æ•°æ®ç»“æ„æ„å»º** - åˆ›å»ºå­—å…¸ï¼Œnamedtuple å¯¹è±¡  
âŒ **ä¸šåŠ¡é€»è¾‘** - è¿‡æ»¤ï¼ŒæŸ¥è¯¢ï¼ŒéªŒè¯

è¿™äº›éƒ½æ˜¯ **CPU å¯†é›†å‹æ“ä½œ**ï¼Œä¸æ•°æ®æ˜¯å¦åœ¨æœ¬åœ°æ— å…³ï¼

## ğŸ› PyPath è®¾è®¡é—®é¢˜

æŸ¥çœ‹ `/root/.../pypath/inputs/string.py` ç¬¬ 45-54 è¡Œ:

```python
def string_links_interactions(..., physical_interaction_score=True):
    if physical_interaction_score:
        phy_links = dict(
            ((i.protein_a, i.protein_b), i.combined_score)
            for i in
            string_physical_interactions(
                ncbi_tax_id = ncbi_tax_id,
                score_threshold = 0,  # âš ï¸ æ€»æ˜¯ 0!
            )
        )
```

**é—®é¢˜**:
- ç”¨æˆ·è°ƒç”¨ `string_links_interactions(score_threshold='high_confidence')`
- æœŸæœ›åªè·å– high confidence çš„æ•°æ®
- ä½†ä¸ºäº†å¡«å…… `physical_combined_score` å­—æ®µ
- **å‡½æ•°å¿…é¡»å…ˆè¯»å– ALL (score >= 0) çš„ physical interactions**

**å½±å“**:
- High confidence: 173,038 æ¡ â†’ å¿«
- **All (score=0): 1,477,610 æ¡ â†’ æ…¢ 8.5x**

## ğŸ“ˆ æ—¶é—´æ¶ˆè€—å æ¯”

å¯¹äºå•ä¸ªç‰©ç§:

| æ“ä½œ | æ—¶é—´ | å æ¯” |
|------|------|------|
| **è§£å‹æ–‡ä»¶** | ~5s | **33%** |
| **è§£ææ–‡æœ¬** | ~7s | **47%** |
| æ„å»ºå­—å…¸ | ~1s | 7% |
| æŸ¥è¯¢è¿‡æ»¤ | ~2s | 13% |

**ç“¶é¢ˆ**: 80% æ—¶é—´æ¶ˆè€—åœ¨ I/O å’Œæ–‡æœ¬å¤„ç†

## ğŸ§ª æµ‹è¯•éªŒè¯

å·²åˆ›å»º4ä¸ªæµ‹è¯•æ–‡ä»¶éªŒè¯åˆ†æ:

```bash
# 1. PPI è¾¹ç”Ÿæˆæ€§èƒ½ (è¯æ˜ normalize_curie ä¸æ˜¯ä¸»è¦ç“¶é¢ˆ)
python test/profile_ppi_simple.py

# 2. STRING è¯»å–æ·±åº¦åˆ†æ (å‘ç° physical_interaction_score çš„å½±å“)
python test/analyze_string_bottleneck.py

# 3. ç²¾ç¡®å¤ç°å®é™…è°ƒç”¨
python test/profile_string_exact.py

# 4. é…ç½®å’Œæ—¶é—´ä¼°ç®—
python test/analyze_real_bottleneck.py
```

**æµ‹è¯•ç»“æœä¸ç†è®ºåˆ†æä¸€è‡´** âœ“

## ğŸ’¡ ç»“è®º

### âŒ ä¸æ˜¯è¿™äº›åŸå› ï¼š
- é…ç½®é”™è¯¯
- ç¼“å­˜æœªç”Ÿæ•ˆ
- ç½‘ç»œæ…¢
- ä»£ç  bug (é™¤äº† line 705 çš„å°é—®é¢˜)

### âœ… çœŸæ­£çš„åŸå› ï¼š
1. **12,535 ä¸ªç‰©ç§** - æ•°é‡å¤ªå¤š
2. **æ¯ä¸ªç‰©ç§ ~15ç§’** - æ•°æ®å¤„ç†å›ºæœ‰æˆæœ¬
   - è§£å‹ .gz æ–‡ä»¶
   - è§£æç™¾ä¸‡çº§æ–‡æœ¬
   - æ„å»ºæ•°æ®ç»“æ„
3. **PyPath è®¾è®¡** - æ€»æ˜¯è¯»å– ALL physical interactions

### ğŸ¯ è¿™å°±æ˜¯æ­£å¸¸çš„å¤„ç†æ—¶é—´

å¯¹äº 12,535 ä¸ªç‰©ç§çš„ STRING æ•°æ®:
- **52+ å°æ—¶æ˜¯åˆç†çš„å¤„ç†æ—¶é—´**
- ä¸æ˜¯ bugï¼Œæ˜¯æ•°æ®é‡å†³å®šçš„
- æ¯ä¸ªç‰©ç§éƒ½å¿…é¡»ç‹¬ç«‹å¤„ç†

### ğŸ“Œ å…¶ä»–å‘ç°

**æ•°æ®æ–‡ä»¶å¯èƒ½æœ‰é—®é¢˜**:
```
IndexError: list index out of range
zlib.error: invalid block type
```

å»ºè®®æ£€æŸ¥ç¼“å­˜æ–‡ä»¶å®Œæ•´æ€§:
```bash
find /GenSIvePFS/users/data/pypath_cache/string/ -name "*.gz" -exec gzip -t {} \; 2>&1 | grep -i error
```

---

**åˆ†ææ—¥æœŸ**: 2026-01-23  
**è¯¦ç»†æŠ¥å‘Š**: docs/STRING_BOTTLENECK_DEEP_ANALYSIS.md  
**æµ‹è¯•ä»£ç **: test/profile_ppi_simple.py, test/analyze_string_bottleneck.py
